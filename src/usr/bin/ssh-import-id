#!/bin/sh

if [ "${FORCE:-0}" == "0" ]; then
   cat 1>&2 <<EOF
Sorry. ssh-import-id needs https support and our wget does not have it.
don't believe me? try with: FORCE=1 ${0##*/} user
EOF
exit 1
fi

cd
umask 066
fail() { echo "$@" 1>&2; exit 1; }
mkdir -m 755 -p .ssh  || { fail "failed to make .ssh dir" 1>&2; exit 1; }

for u in "$@"; do
   out=$(wget -O - "https://launchpad.net/~$u/+sshkeys") ||
      fail "failed to get key for $u" 1>&2
   printf "%s" "$out" >> ".ssh/authorized_keys" ||
      fail "failed to write to .ssh/authorized_keys"
   echo "authorized $u" 1>&2
done
